<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
	<title>StreetStyle</title>
	<script src="//cdn.jsdelivr.net/phaser/2.4.3/phaser.min.js"></script>
	<script src="assets.json"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
        canvas {
        	width: 400px;
        	height: 700px;
        	border-width: 1px;
        	border-color: black;
        }
    </style>
</head>
<body>
<div id="game"></div>
<script type="text/javascript">

var imagedata = JSON.parse(data);
var game = new Phaser.Game(400, 700, Phaser.AUTO, 'game', { preload: preload, create: create, update: update }, true, false);
var npcs = [];
var initialScale = 0;
var initialX = 0;
var initialY = -200;
var hover = false;
var emojiCursor;

function createRandomSprite(type){
	object = imagedata[type];
	var index = Math.floor((Math.random() * object.length));
	var frame1 = type + '/' + (index + 1) + '/' + object[index]["1"];
	var frame2 = type + '/' + (index + 1) + '/' + object[index]["2"];
	var sprite = game.add.sprite(initialX, initialY, 'fashion', frame1);
	sprite.scale.setTo(initialScale, initialScale);
	sprite.animations.add('walk', [frame1, frame2], 2.5, true, false);
	sprite.animations.play('walk');
	return sprite;
}


function newNPC(){
	var spriteGroup = game.add.group();
	spriteGroup.add(createRandomSprite('body'));
	spriteGroup.add(createRandomSprite('hair'));

	var random = Math.floor((Math.random() * 2));
	if (random == 0){
		spriteGroup.add(createRandomSprite('jumpsuits'));
	}
	else {
		spriteGroup.add(createRandomSprite('pants'));
		spriteGroup.add(createRandomSprite('tops'));		
	}

	spriteGroup.add(createRandomSprite('shoes'));
	spriteGroup.forEach(function(item) {
				item.inputEnabled = true;
				item.input.useHandCursor = true; 
			   item.events.onInputOver.add(function(i){
											hover = true;
											emojiCursor.visible = true;
										}, this);
				item.events.onInputOut.add(function(i){
											hover = false;
											emojiCursor.visible = false;
										}, this);
				item.events.onInputDown.add(clickOnStyle, this);			   
			}, this);
	var npc = {};
	npc.x = initialX;
	npc.y = initialY;
	npc.scale = initialScale;
	npc.sprites = spriteGroup;
	return npc;
}

function clickOnStyle(){
	text = game.add.bitmapText(175, 200, "superscript", "I love your\noutfit!", 30);
}

function preload() {
	game.load.atlasJSONHash('fashion', 'images/fashion.png', 'images/fashion.json');
	game.load.spritesheet('emojis', 'images/emojis/sheet_apple_32.png', 32, 32, 1186);
	game.load.bitmapFont('superscript', 'font/superscript.png', 'font/superscript.fnt');
}

function create() {	
	
	npcs.push(newNPC());	
	emojiCursor = game.add.sprite(0, 0, 'emojis', 93);
	emojiCursor.visible = false;
}

function update() {
	if (!hover){
		for (var i=0; i < npcs.length; i++){
			npcs[i].y += 0.75;
			var scale = (((npcs[i].y)/700)*(1.5))+3;
			npcs[i].sprites.forEach(function(item) {
			   item.y = npcs[i].y;
			   item.scale.setTo(scale, scale);
			}, this);
		}	

		if (npcs[0].y > 700){
			npcs.shift();
			npcs.push(newNPC());
		}
	}
	else {
		emojiCursor.x = game.input.x;
		emojiCursor.y = game.input.y;
	}
}

</script>

</body>
</html>